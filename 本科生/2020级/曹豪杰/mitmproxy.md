#   mitmproxy运用
##  2022.1.20
    在爬虫中，我们往往会倾向于让爬虫看上去更像正常浏览。
    为此，我们会为爬虫添加各种变量，如修改爬虫的头，添加鼠标随机点击，随机时间操作等。但是无论怎么更改，爬虫依旧还是爬虫，总会有无法更改的地方。
    在爬取判决文书网的时候，我发现判决文书网的接口是动态加密的，这意味着寻常的request没办法直接访问。
    一般碰到这种情况时我们会选用比较通用的selenium进行操作，但就在去年判决文书网更新了反爬程序，导致selenium也失效了。

    为此，我必须找出新的方法。

    通过分析网页js，我发现判决文书网的反爬是独立在一个js文件里面的。
    https://wenshu.court.gov.cn/gGK4jBsBBszn/c3aqs9gktfr4.dfe1675.js

    令人头疼的是，这个js是经过混淆加密的，这对我来说并不怎么友好。
    但是我也找到了其中最关键的信息：
   
    ~m`u__driver_evaluateB__webdriver_evaluateB__selenium_evaluateB__fxdriver_evaluateB__driver_unwrappedB
   
    在这一段信息中同时出现了driver和selenium，我猜测，这一段信息很大程度上可能是反爬的代码。

    所以我进行了一次大胆的尝试，我架设了一个中间人代理：mitmproxy

    mitmproxy是一个中间人，它能在用户和服务器传输数据时拦截并修改数据。

    我让mitmproxy监听8080端口，拦截c3aqs9gktfr4.dfe1675.js文件并删除文件内所有内容。
    这样做的效果非常显著，我的selenium直接绕开的js成功进行了操作。

    但仅仅是简单的删除是完全不够的，因为网站的登录代码也在c3aqs9gktfr4.dfe1675.js中，删除文件意味着我也没办法登录。
    所以我想到了修改。
    但是具体怎么修改？我对网站进行的单步跟踪。我发现c3aqs9gktfr4.dfe1675.js中存储的是一条代码字符串，它本身不具有运行能力，在外部的解密后才会运行。
    所以，任何更改字符串长度的做法都是不允许的，这样会导致解密混乱，往后的代码也会失效。

    所以更改内容时不能改变长度，比如我用abcefg来代替driver,这样保证了反爬代码的错误运行，因为保证了后面的代码不会失效。
    就当我要实践时，服务器掉线了。那今天就先写到这吧。
    